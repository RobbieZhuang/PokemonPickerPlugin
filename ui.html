<h2>Shape Creator</h2>
<p>Count: <input id="count" type="number" value="5"></p>
<button id="create">Insert Pokemon</button>
<button id="cancel">Cancel</button>
<script>

document.getElementById('create').onclick = async () => {
  const textbox = document.getElementById('count');
  const count = parseInt(textbox.value, 10);

  const response = await fetch('https://api.pokemontcg.io/v2/cards/base1-13', {method: 'GET'});
  const data = await response.json();
  const imageResponse = await fetch(data.data.images.large, {});
  const image = await new Response(imageResponse.body).arrayBuffer();
  window.parent.postMessage({pluginMessage: {type: "card", data: image}}, "*");
  // var request = new XMLHttpRequest();
  // request.open('GET', 'https://api.pokemontcg.io/v2/cards/base1-13');
  // request.responseType = "json";
  // console.log("gonna send req")
  // request.onload = () => {
  //   console.log("got response")
  //   // const imageUrl = request.response.data.images.large;

  //   // const image = await fetch(imageUrl);
  //   // const imageBuffer = await image.arrayBuffer();
  //   // const imageArray = Uint8Array(imageBuffer);
  //   window.parent.postMessage({pluginMessage: {type: "card", data: imageArray}}, "*");
  // }
  // request.send();
  // parent.postMessage({ pluginMessage: { type: 'create-shapes', count } }, '*')
}

document.getElementById('cancel').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
}

</script>
